

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Unix &mdash; cpymad 1.4.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Windows" href="windows.html" />
    <link rel="prev" title="Installation Instructions" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> cpymad
          

          
          </a>

          
            
            
              <div class="version">
                1.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation Instructions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Unix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-libmadx">Install libmadx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-cpymad">Install cpymad</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-cpymad-manually">Building cpymad manually</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="windows.html">Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="offline.html">Offline installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cpymad/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known-issues.html">Known issues</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cpymad</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Installation Instructions</a> &raquo;</li>
        
      <li>Unix</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/installation/unix.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="unix">
<h1>Unix<a class="headerlink" href="#unix" title="Permalink to this headline">¶</a></h1>
<p>There are now binary wheels for most supported target platforms. With these
the installation is as simple as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install cpymad
</pre></div>
</div>
<p>If a wheel for your platform is not available, this command may pick up the
source package and try to build from scratch.</p>
<p>Since cpymad is linked against a special library version of MAD-X, and
therefore must usually compile MAD-X from source before it can be built (even
if you have the MAD-X executable installed). This means that the cpymad setup
can take between 5 and 30 minutes, depending on your internet bandwidth and
machine performance.</p>
<p>In case of failure, you should build MAD-X and cpymad manually, as described
below.</p>
<div class="section" id="install-libmadx">
<h2>Install libmadx<a class="headerlink" href="#install-libmadx" title="Permalink to this headline">¶</a></h2>
<p>cpymad requires a library build of MAD-X. The official executable is not
sufficient. In order to build MAD-X from source you will need the following
programs:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.cmake.org/">CMake</a> &gt;= 3.0</p></li>
<li><p>gcc &gt;= 4.8, along with gfortran (other C/C++/fortran compiler suites may
work too but are untested as of now)</p></li>
</ul>
<p>Download the <a class="reference external" href="http://madx.web.cern.ch/madx/releases/last-rel">latest MAD-X release</a> <a class="reference external" href="https://github.com/MethodicalAcceleratorDesign/MAD-X/releases">from github</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://github.com/MethodicalAcceleratorDesign/MAD-X/archive/5.05.01.tar.gz
tar -xzf MAD-X-5.05.01.tar.gz
</pre></div>
</div>
<p>or use directly the source code from master (unstable):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/MethodicalAcceleratorDesign/MAD-X
</pre></div>
</div>
<p>We will do an out-of-source build in a <code class="docutils literal notranslate"><span class="pre">build/</span></code> subdirectory. This way, you
can easily delete the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory and restart if anything goes wrong.
The basic process looks as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> MAD-X
mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake .. <span class="se">\</span>
    -DMADX_ONLINE<span class="o">=</span>OFF <span class="se">\</span>
    -DMADX_INSTALL_DOC<span class="o">=</span>OFF <span class="se">\</span>
    -DCMAKE_INSTALL_PREFIX<span class="o">=</span>../install <span class="se">\</span>
    -DCMAKE_C_FLAGS<span class="o">=</span><span class="s2">&quot;-fvisibility=hidden&quot;</span>
make <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
<p>Here, we have turned off the online model, documentation files and, more
importantly, have used a custom installation prefix to prevent cmake from
installing MAD-X to a system directory (which would require root privileges,
and may be harder to remove completely). The last argument prevents a class of
crashes due to symbol collisions with other subsystems such as the C standard
library.</p>
<p>If you prefer a more permanent install location
(<code class="docutils literal notranslate"><span class="pre">-DCMAKE_INSTALL_PREFIX=XXX</span></code>), the most common ones are as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>~/.local                user-level installation, no sudo required
/opt/madx               system-wide but easily removable installation
/opt/madx/&lt;VERSION&gt;     <span class="k">if</span> you plan to install several versions side-by-side
/usr                    system, usually default, mixes with your system files
/usr/local              system, <span class="nb">local</span> machine <span class="o">(</span>not always used<span class="o">)</span>, mixes like /usr
</pre></div>
</div>
<p>Although the cmake command has many more options I will mention only the
following:</p>
<p>You can pass <code class="docutils literal notranslate"><span class="pre">-DMADX_STATIC=ON</span></code> to specify that the link dependencies of
MAD-X itself (libc, libgfortran, libstdc++, blas, lapack, etc) should be
linked statically when building cpymad later. This may be attempted in case of
problems and is not guaranteed to work on all platforms (if your OS e.g.  does
not distribute <code class="docutils literal notranslate"><span class="pre">libgfortran.a</span></code> as is the case on archlinux). Note that even
if you do not set this flag, cpymad will still be linked statically against
MAD-X, just not against the c/c++/fortran/etc runtimes.</p>
<p>You can pass <code class="docutils literal notranslate"><span class="pre">-DBUILD_SHARED_LIBS=ON</span></code> if you want to link cpymad dynamically
against MAD-X. In theory, this allows using, testing and even updating the
MAD-X shared object independently of cpymad, but probably does more harm than
good in practice. If using this option, please change the visibility to
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_FLAGS=&quot;-fvisibility=protected&quot;</span></code> and be aware that you have to
make sure to <strong>install MAD-X to a permanent location</strong> where it can be found
at runtime. Usually this means installing to the (default) system directories,
but it can also be done by setting the <a class="reference external" href="http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html">LD_LIBRARY_PATH</a> environment variable
or passing appropriate <code class="docutils literal notranslate"><span class="pre">--rpath</span></code> to the setup script.</p>
</div>
<div class="section" id="install-cpymad">
<h2>Install cpymad<a class="headerlink" href="#install-cpymad" title="Permalink to this headline">¶</a></h2>
<p>After having built MAD-X we can now build cpymad. You will need:</p>
<ul class="simple">
<li><p>python &gt;= 2.7, but higher versions (&gt;=3.7) are preferred</p></li>
<li><p><a class="reference external" href="https://pypi.org/project/setuptools">setuptools</a> python package</p></li>
<li><p><a class="reference external" href="http://cython.org/">Cython</a>, if you plan to work with the git checkout. Cython can be installed
using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">cython</span></code> (this is unnecessary for the release tarball
from PyPI)</p></li>
</ul>
<p>Concerning runtime dependencies on other python packages, cpymad requires only
<a class="reference external" href="http://www.numpy.org/">numpy</a> and <a class="reference external" href="https://pypi.org/project/minrpc">minrpc</a>, both of which should usually be resolved automatically by
<a class="reference external" href="https://pypi.org/project/pip">pip</a> or the setup script. If you plan to install in an offline environment,
you can download all dependencies using the command <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">download</span> <span class="pre">cpymad</span></code>.</p>
<p>We will need to tell the cpymad setup script to use our MAD-X installation
path from before. The easiest way to do this is by setting an environment
variable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">MADXDIR</span><span class="o">=</span>/PATH/TO/CMAKE_INSTALL_PREFIX
</pre></div>
</div>
<p>If you did build MAD-X with <code class="docutils literal notranslate"><span class="pre">-DBUILD_SHARED_LIBS</span></code> or <code class="docutils literal notranslate"><span class="pre">-DMADX_STATIC</span></code>
you should also set the corresponding option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">SHARED</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># or:</span>

<span class="nb">export</span> <span class="nv">STATIC</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>With these settings in place, you can try installing cpymad as before:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install --no-binary<span class="o">=</span>cpymad cpymad
</pre></div>
</div>
</div>
<div class="section" id="building-cpymad-manually">
<h2>Building cpymad manually<a class="headerlink" href="#building-cpymad-manually" title="Permalink to this headline">¶</a></h2>
<p>If the installation fails or produces an unloadable version of cpymad, fetch
<a class="reference external" href="https://pypi.org/project/cpymad#files">latest cpymad release</a> from PyPI (the idea is that this grants you more
control over the build options and alter the setup script if necessary):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip download --no-binary<span class="o">=</span>cpymad --no-deps cpymad
tar -xzf cpymad-*.tar.gz
</pre></div>
</div>
<p>Alternatively, fetch the very latest <a class="reference external" href="https://github.com/hibtc/cpymad">cpymad</a> <a class="reference external" href="https://github.com/hibtc/cpymad/zipball/master">source</a> from git:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/hibtc/cpymad
</pre></div>
</div>
<p>After that, build cpymad and enter development mode so that changes in the
local directory will take effect immediately (don’t forget to export the MAD-X
path as above):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> cpymad
python setup.py build_ext
</pre></div>
</div>
<p>The advantage with this method is that you can pass additional compiler or
linker arguments to the <code class="docutils literal notranslate"><span class="pre">build_ext</span></code> command. For example, if you happened to
build MAD-X with blas/lapack, you may need to pass additional linklibs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py build_ext -lblas -llapack
</pre></div>
</div>
<p>Once you get cpymad working you may wish to make your installation more
permanent, by e.g. using the <code class="docutils literal notranslate"><span class="pre">install</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>Or even creating a wheel that can be installed using pip:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py bdist_wheel
pip install dist/cpymad-*.whl
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="windows.html" class="btn btn-neutral float-right" title="Windows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Installation Instructions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2017, T. Gläßle (HIT),2011-2013 Y.I. Levinsen, K. Fuchsberger (CERN)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>